# /config/files/integral.yaml

#sensor:

  - platform: integration
    source: sensor.eb3_active_power_l1
    name: EM EB3 L1
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.eb3_active_power_l2
    name: EM EB3 L2
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.eb3_active_power_l3
    name: EM EB3 L3
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.z1_test
    name: z1 test kwh
    unit_prefix: k
    round: 2

  - platform: template
    sensors:

      z1_test:
        friendly_name: z1 test
        icon_template: 'mdi:lightning-bolt'
        unit_of_measurement: "W"
        device_class: power
        value_template: >-
            {% set updateactivator = states('sensor.eb3_active_power_l3') %}
            {{ range(601, 605)|random }}

      u1_power:
        friendly_name: U1 Power
        value_template: >-
            {% set a = states('sensor.u1_nominal_real_power')|int %}
            {% set b = states('sensor.u1_load')|int %}
            {{  (a * b / 100)|int }}
        device_class: power
        unit_of_measurement: "W"

      sun_elevation:
        friendly_name: Sun Elevation
        unit_of_measurement: 'Â°'
        value_template: "{{ state_attr('sun.sun', 'elevation') }}"

      fake_solar:
        friendly_name: Fake Solar
        value_template: >-
            {% set a = states('sensor.mmc_3e_temp')|float + 10 %}
            {% set b = states('sensor.sun_elevation')|float %}
            {% set c = (b * a * 0.77)|int %}
            {% if c > 0 %}   
              {{ c }}
            {% else %}
              {{ 1 }}
            {% endif %}
        device_class: power
        unit_of_measurement: "W"

  - platform: integration
    source: sensor.u1_power
    name: EM UPS U1
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.fake_solar
    name: EM Fake Solar
    unit_prefix: k
    round: 2

# EOF
