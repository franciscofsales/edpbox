# /config/files/integral.yaml

#sensor:

  - platform: template
    sensors:

      u1_power:
        friendly_name: U1 Power
        value_template: >-
            {% set a = states('sensor.u1_nominal_real_power')|int %}
            {% set b = states('sensor.u1_load')|int %}
            {{  (a * b / 100)|int }}
        device_class: power
        unit_of_measurement: "W"

      sun_elevation:
        friendly_name: Sun Elevation
        unit_of_measurement: 'Â°'
        value_template: "{{ state_attr('sun.sun', 'elevation') }}"

      fake_solar_w:
        friendly_name: Fake Solar W
        value_template: >-
            {% set a = states('sensor.sun_elevation')|float %}
            {% set b = states('sensor.mmc_3e_temp')|float %}
            {% set c =  (a * 5) + ( b * 15 * 4) %}
            {% if a > 0 and b > 0 %}
              {{ c|round(2) }}
            {% endif %}
        device_class: power
        unit_of_measurement: "W"

###

  - platform: integration
    source: sensor.eb3_active_power_l1
    name: EM3 L1
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.eb3_active_power_l2
    name: EM3 L2
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.eb3_active_power_l3
    name: EM3 L3
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.u1_power
    name: EM UPS1
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.fake_solar_w
    name: Fake Solar
    unit_prefix: k
    round: 2

# EOF
