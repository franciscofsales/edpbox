# EB3 template sensor (new style)
# template: !include files/template.yaml

#template:

  - sensor:

    - name: "EB3 Clock"
      state: >-
        {% if states('sensor.eb3_0x0001') is defined %}
          {% set hh = states('sensor.eb3_0x0001').split(',')[4] | int %}
          {% set mm = states('sensor.eb3_0x0001').split(',')[5] | int %}
          {% set ss = states('sensor.eb3_0x0001').split(',')[6] | int %}
          {{ '{0:02d}'.format(hh) + ":" + '{0:02d}'.format(mm) + ":" + '{0:02d}'.format(ss) }}
        {% else %}
          {{ states('sensor.eb3_clock') }}
        {% endif %}
      icon: mdi:clock

# 16

    - name: "EB3 Import"
      state: >-
        {% if states('sensor.eb3_0x0016') is defined %}
          {% set x = states('sensor.eb3_0x0016').split(',')[0] | float %}
          {{ (x / 1000) | round(1) }}
        {% else %}
          {{ states('sensor.eb3_import') }}
        {% endif %}
      unit_of_measurement: "kWh"
      device_class: energy
      state_class: measurement

    - name: "EB3 Export"
      state: >-
        {% if states('sensor.eb3_0x0016') is defined %}
          {% set x = states('sensor.eb3_0x0016').split(',')[1] | float %}
          {{ (x / 1000) | round(3) }}
        {% else %}
          {{ states('sensor.eb3_export') }}
        {% endif %}
      unit_of_measurement: "kWh"
      device_class: energy
      state_class: measurement

# 26

      
    - name: "EB3 T1 Vazio"
      state: >-
        {% if states('sensor.eb3_0x0026') is defined %}
          {% set x = states('sensor.eb3_0x0026').split(',')[0] | float %}
            {{ (x / 1000) | round(1) }}
        {% else %}
          {{ states('sensor.eb3_t1_vazio') }}
        {% endif %}
      unit_of_measurement: "kWh"
      device_class: energy
      state_class: measurement

    - name: "EB3 T2 Ponta"
      state: >-
        {% if states('sensor.eb3_0x0026') is defined %}
          {% set x = states('sensor.eb3_0x0026').split(',')[1] | float %}
          {{ (x / 1000) | round(1) }}
        {% else %}
          {{ states('sensor.eb3_t2_ponta') }}
        {% endif %}
      unit_of_measurement: "kWh"
      device_class: energy
      state_class: measurement

    - name: "EB3 T3 Cheias"
      state: >-
        {% if states('sensor.eb3_0x0026') is defined %}
          {% set x = states('sensor.eb3_0x0026').split(',')[2] | float %}
          {{ (x / 1000) | round(1) }}
        {% else %}
          {{ states('sensor.eb3_t3_cheias') }}
        {% endif %}
      unit_of_measurement: "kWh"
      device_class: energy
      state_class: measurement

# EOF
