# sensor eb1mod: !include modbus-eb1.yaml

  - platform: template
    sensors:

      eb1_clock:
        friendly_name: "EB1 Clock"
        value_template: >-
            {% set hh = states('sensor.eb1_0x0001').split(',')[4] | int %}
            {% set mm = states('sensor.eb1_0x0001').split(',')[5] | int %}
            {% set ss = states('sensor.eb1_0x0001').split(',')[6] | int %}
            {{ '{0:02d}'.format(hh) + ":" + '{0:02d}'.format(mm) + ":" + '{0:02d}'.format(ss) }}
        icon_template: mdi:clock

      eb1_voltage_l1:
        friendly_name: "EB1 Voltage L1"
        value_template: >-
            {% set x = states('sensor.eb1_0x006c').split(',')[0] | float %}
            {% if x %}
              {{ x / 10 }}
            {% endif %}
        unit_of_measurement: "V"
        device_class: voltage

      eb1_voltage_l1_10:
        friendly_name: "EB1 Voltage L1-10"
        value_template: >-
            {% set x = states('sensor.eb1_0x006c').split(',')[0] | float %}
            {% if x %}
              {{ x / 10 - 10 }}
            {% endif %}
        unit_of_measurement: "V"
        device_class: voltage

      eb1_current_l1:
        friendly_name: "EB1 Current L1"
        value_template: >-
            {% set x = states('sensor.eb1_0x006c').split(',')[1] | float %}
            {% if x %}
              {{ x / 10 }}
            {% endif %}
        unit_of_measurement: "A"
        device_class: current

      eb1_voltage_l2:
        friendly_name: "EB1 Voltage L2"
        value_template: >-
            {% set x = states('sensor.eb1_0x006c').split(',')[2] | float %}
            {% if x %}
              {{ x / 10 }}
            {% endif %}
        unit_of_measurement: "V"
        device_class: voltage

      eb1_current_l2:
        friendly_name: "EB1 Current L2"
        value_template: >-
            {% set x = states('sensor.eb1_0x006c').split(',')[3] | float %}
            {% if x %}
              {{ x / 10 }}
            {% endif %}
        unit_of_measurement: "A"
        device_class: current

      eb1_voltage_l3:
        friendly_name: "EB1 Voltage L3"
        value_template: >-
            {% set x = states('sensor.eb1_0x006c').split(',')[4] | float %}
            {% if x %}
              {{ x / 10 }}
            {% endif %}
        unit_of_measurement: "V"
        device_class: voltage

      eb1_voltage_l3_10:
        friendly_name: "EB1 Voltage L3+10"
        value_template: >-
            {% set x = states('sensor.eb1_0x006c').split(',')[4] | float %}
            {% if x %}
              {{ x / 10 + 10 }}
            {% endif %}       
        unit_of_measurement: "V"
        device_class: voltage

      eb1_current_l3:
        friendly_name: "EB1 Current L3"
        value_template: >-
            {% set x = states('sensor.eb1_0x006c').split(',')[5] | float %}
            {% if x %}
              {{ x / 10 }}
            {% endif %}
        unit_of_measurement: "A"
        device_class: current

      eb1_current:
        friendly_name: "EB1 Current"
        value_template: >-
            {% set x = states('sensor.eb1_0x006c').split(',')[6] | float %}
            {% if x %}
              {{ x / 10 }}
            {% endif %}
        unit_of_measurement: "A"
        device_class: current

      eb1_:
        friendly_name: "EB1 Power Factor"
        value_template: >-
                {{ value_json.EB1.PowFac|float }}
        unit_of_measurement: "pu"
        device_class: power_factor

      eb1_:
        friendly_name: "EB1 Power Factor L1"
        value_template: >-
                {{ value_json.EB1.PowFacL1|float }}
        unit_of_measurement: "pu"
        device_class: power_factor

      eb1_:
        friendly_name: "EB1 Power Factor L2"
        value_template: >-
                {{ value_json.EB1.PowFacL2|float }}
        unit_of_measurement: "pu"
        device_class: power_factor

      eb1_:
        friendly_name: "EB1 Power Factor L3"
        value_template: >-
                {{ value_json.EB1.PowFacL3|float }}
        unit_of_measurement: "pu"
        device_class: power_factor

      eb1_:
        friendly_name: "EB1 Active Power"
        value_template: >-
                {{ value_json.EB1.ActPow|int }}
        unit_of_measurement: "W"
        device_class: power

      eb1_:
        friendly_name: "EB1 Active Power L1"
        value_template: >-
                {{ value_json.EB1.ActPowL1|int }}
        unit_of_measurement: "W"
        device_class: power

      eb1_:
        friendly_name: "EB1 Active Power L2"
        value_template: >-
                {{ value_json.EB1.ActPowL2|int }}
        unit_of_measurement: "W"
        device_class: power

      eb1_:
        friendly_name: "EB1 Active Power L3"
        unique_id: EB1_ActLowL3
        state_topic: "tele/edpbox1/SENSOR"
        value_template: >-
                {{ value_json.EB1.ActPowL3|int }}
        unit_of_measurement: "W"
        device_class: power

      eb1_:
        friendly_name: "EB1 Frequency"
        value_template: >-
                {{ value_json.EB1.Frequency|float }}
        unit_of_measurement: "Hz"
        icon_template: mdi:pulse

      eb1_:
        friendly_name: "EB1 Total Energy T1 Vazio"
        value_template: >-
                {% set x = value_json.EB1.TotEneT1|float %}
                {% if x > 0 %}
                  {{ x }}
                {% endif %}
        unit_of_measurement: "kWh"
        icon_template: mdi:transmission-tower
   
      eb1_:
        friendly_name: "EB1 Total Energy T2 Ponta"
        unique_id: EB1_TotEneT2
        state_topic: "tele/edpbox1/SENSOR"
        value_template: >-
                {% set x = value_json.EB1.TotEneT2|float %}
                {% if x > 0 %}
                  {{ x }}
                {% endif %}
        unit_of_measurement: "kWh"
        icon_template: mdi:transmission-tower
        
      eb1_:
        friendly_name: "EB1 Total Energy T3 Cheias"
        value_template: >-
                {% set x = value_json.EB1.TotEneT3|float %}
                {% if x > 0 %}
                  {{ x }}
                {% endif %}
        unit_of_measurement: "kWh"
        icon_template: mdi:transmission-tower

      eb1_:
        friendly_name: "EB1 Total Energy Import"
        value_template: >-
                {% set x = value_json.EB1.TotEneImp|float %}
                {% if x > 0 %}
                  {{ x }}
                {% endif %}
        unit_of_measurement: "kWh"
        device_class: energy

      eb1_:
        friendly_name: "EB1 Total Energy Export"
        value_template: >-
                {% set x = value_json.EB1.TotEneExp|float %}
                {% if x > 0 %}
                  {{ x }}
                {% endif %}
        unit_of_measurement: "kWh"
        device_class: energy

# EOF
