# Based on eb3tri
# May not be updated

  - platform: mqtt
    name: "EB1 ESP Uptime"
    unique_id: EB1_ESP_Uptime
    state_topic: "tele/edpbox1/STATE"
    value_template: '{{ ( value_json.UptimeSec / 3600 ) | round(1) }}'
    unit_of_measurement: "h"
    icon: mdi:alarm

  - platform: mqtt
    name: "EB1 ESP Free Heap"
    unique_id: EB1_ESP_Heap
    state_topic: "tele/edpbox1/STATE"
    value_template: '{{ value_json.Heap }}'
    unit_of_measurement: "kB"
    icon: mdi:chip

  - platform: mqtt
    name: "EB1 ESP Signal"
    unique_id: EB1_ESP_Signal
    state_topic: "tele/edpbox1/STATE"
    value_template: '{{ value_json.Wifi.Signal }}'
    unit_of_measurement: "dB"
    device_class: signal_strength

  - platform: mqtt
    name: "EB1 Clock"
    unique_id: EB1_Clock
    state_topic: "tele/edpbox1/SENSOR"
    value_template: >-
        {% set hh = value_json.EB1.Clock_H|int %}
        {% set mm = value_json.EB1.Clock_M|int %}
        {% set ss = value_json.EB1.Clock_S|int %}
        {{ '{0:02d}'.format(hh) + ":" + '{0:02d}'.format(mm) + ":" + '{0:02d}'.format(ss) }}
    icon: mdi:clock

  - platform: mqtt
    name: "EB1 Voltage L1"
    unique_id: EB1_VolL1
    state_topic: "tele/edpbox1/SENSOR"
    value_template: >-
        {{ value_json.EB1.VolL1|float }}
    unit_of_measurement: "V"
    device_class: voltage


  - platform: mqtt
    name: "EB1 Current L1"
    unique_id: EB1_CurL1
    state_topic: "tele/edpbox1/SENSOR"
    value_template: >-
        {{ value_json.EB1.CurL1|float }}
    unit_of_measurement: "A"
    device_class: current




  - platform: mqtt
    name: "EB1 Power Factor"
    unique_id: EB1_PowFac
    state_topic: "tele/edpbox1/SENSOR"
    value_template: >-
        {{ value_json.EB1.PowFac|float }}
    unit_of_measurement: "pu"
    device_class: power_factor





  - platform: mqtt
    name: "EB1 Active Power"
    unique_id: EB1_ActPow
    state_topic: "tele/edpbox1/SENSOR"
    value_template: >-
        {{ value_json.EB1.ActPow|int }}
    unit_of_measurement: "W"
    device_class: power




  - platform: mqtt
    name: "EB1 Frequency"
    unique_id: EB1_Frequency
    state_topic: "tele/edpbox1/SENSOR"
    value_template: >-
        {{ value_json.EB1.Frequency|float }}
    unit_of_measurement: "Hz"
    icon: mdi:pulse

  - platform: mqtt
    name: "EB1 Total Energy T1 Vazio"
    unique_id: EB1_TotEneT1
    state_topic: "tele/edpbox1/SENSOR"
    value_template: >-
        {% set x = value_json.EB1.TotEneT1|float %}
        {% if x > 0 %}
          {{ x }}
        {% endif %}
    unit_of_measurement: "kWh"
    icon: mdi:transmission-tower
   
  - platform: mqtt
    name: "EB1 Total Energy T2 Ponta"
    unique_id: EB1_TotEneT2
    state_topic: "tele/edpbox1/SENSOR"
    value_template: >-
        {% set x = value_json.EB1.TotEneT2|float %}
        {% if x > 0 %}
          {{ x }}
        {% endif %}
    unit_of_measurement: "kWh"
    icon: mdi:transmission-tower
    
  - platform: mqtt
    name: "EB1 Total Energy T3 Cheias"
    unique_id: EB1_TotEneT3
    state_topic: "tele/edpbox1/SENSOR"
    value_template: >-
        {% set x = value_json.EB1.TotEneT3|float %}
        {% if x > 0 %}
          {{ x }}
        {% endif %}
    unit_of_measurement: "kWh"
    icon: mdi:transmission-tower

  - platform: mqtt
    name: "EB1 Total Energy Import"
    unique_id: EB1_TotEneImp
    state_topic: "tele/edpbox1/SENSOR"
    value_template: >-
        {% set x = value_json.EB1.TotEneImp|float %}
        {% if x > 0 %}
          {{ x }}
        {% endif %}
    unit_of_measurement: "kWh"
    device_class: energy

  - platform: mqtt
    name: "EB1 Total Energy Export"
    unique_id: EB1_TotEneExp
    state_topic: "tele/edpbox1/SENSOR"
    value_template: >-
        {% set x = value_json.EB1.TotEneExp|float %}
        {% if x > 0 %}
          {{ x }}
        {% endif %}
    unit_of_measurement: "kWh"
    device_class: energy

###
##
#

